<body class="">
  <!-- <body data-layout="horizontal"> -->
  <title>Ksa Student || Dashboard</title>

  <!-- Begin page -->
  <div id="layout-wrapper">
    <app-header></app-header>

    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="main-content">
      <div class="page-content">
        <div class="container-fluid blogs_bage">
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div
                  *ngIf="!search"
                  class="card-header d-flex justify-content-between align-items-center"
                >
                  <h4 class="card-title">Blogs Page</h4>
                  <div class="">
                    <button
                      class="btn btnbebe mt-2"
                      (click)="emptyForm()"
                      routerLink="/add-blog"
                      aria-hidden="true"
                    >
                      Add
                    </button>

                    <!-- <button class="btn btnbebe mt-2" (click)="emptyForm()"  data-bs-toggle="modal" data-bs-target="#add"   aria-hidden="true">Add</button> -->
                  </div>
                </div>
                <div
                  *ngIf="search"
                  class="card-header d-flex justify-content-between align-items-center"
                >
                  <h4 class="card-title">Search Blogs</h4>
                </div>
                <div class="card-body">
                  <!-- <div class="row" style="  position: absolute;right: 25px; top: 5rem; z-index: 555; " *ngIf="!all">
                                        <div class="col-md-6 "  *ngIf="!loading">


                                            <div class="col-md-12 dropdep" style=" top: 5rem; display: flex; justify-content: center;" >



                                            <span style="align-items: center; display: flex; ">Categories</span>

                                            <select id="allData" class="form-control" style="display: flex;  width: 60%; margin-left: 10px; min-width: 80px;  " [(ngModel)]="selectedCategoryId" (ngModelChange)="onCategoryChange()">
                                                <option value="selected">All</option>
                                                <option [title]="Category.ar_title"  *ngFor="let Category of CategoryAarry" [ngValue]="Category.id">{{ truncateText(Category.ar_title,60) }}</option>
                                              </select>

                                            </div>
                                        </div>

                                        <div class="col-md-6 d-flex justify-content-end"  *ngIf="!loading">


                                            <div class="col-md-12 dropdep" style=" top: 10rem; display: flex;"   *ngIf="noSub">



                                            <span style="align-items: center; display: flex;">Subcategories</span>

                                            <select id="allDataSub" class="form-control" style="display: flex; width: 60%; margin-left: 10px;  " [(ngModel)]="selectedCategoryIdSub" (ngModelChange)="onCategoryChangeSub()">
                                                <option value="selected" [disabled] = true >All</option>
                                                <option [title]="Category.ar_title" *ngFor="let Category of CategoryFilterBySub" [ngValue]="Category.id">{{ truncateText(Category.ar_title,60) }}</option>
                                              </select>

                                            </div>
                                        </div>
                                      </div>
                                 -->

                  <div
                    class="w-100 spinner d-flex justify-content-center align-items-center"
                    *ngIf="loading"
                  >
                    <app-spinner></app-spinner>
                  </div>

                  <div
                    *ngIf="showAddMSG"
                    class="alert alert-success"
                    role="alert"
                  >
                    Data added successfully
                  </div>

                  <div
                    *ngIf="showUpdateMSG"
                    class="alert alert-success"
                    role="alert"
                  >
                    Data updated successfully
                  </div>

                  <div
                    *ngIf="deleteMSG"
                    class="alert alert-success"
                    role="alert"
                  >
                    Data disabled successfully
                  </div>

                  <div
                    *ngIf="recoveryMSG"
                    class="alert alert-success"
                    role="alert"
                  >
                    Data activated successfully
                  </div>

                  <div class="position-relative">
                    <!-- pagination -->
                    <div *ngIf="hidden">
                      navigation
                      <nav
                        aria-label="Page navigation example"
                        style="
                          position: absolute;
                          bottom: -17px;
                          right: 18px;
                          z-index: 99;
                          height: auto !important;
                        "
                        *ngIf="!loading"
                      >
                        <ul class="pagination p-0 d-flex" *ngIf="all">
                          <li class="page-item">
                            <button
                              class="page-link"
                              [disabled]="currentPage == 1"
                              (click)="back()"
                            >
                              Previous
                            </button>
                          </li>
                          <li class="page-item">
                            <button
                              class="page-link"
                              *ngIf="currentPage != 1"
                              (click)="first()"
                            >
                              1
                            </button>
                          </li>
                          <li class="page-item">
                            <button
                              class="page-link"
                              *ngIf="currentPage != 1"
                              [disabled]="true"
                            >
                              ...
                            </button>
                          </li>

                          <li class="page-item">
                            <a class="page-link active"> {{ currentPage }}</a>
                          </li>
                          <li class="page-item">
                            <button
                              class="page-link"
                              *ngIf="currentPage != lastPage"
                              [disabled]="true"
                            >
                              ...
                            </button>
                          </li>

                          <li class="page-item">
                            <button
                              class="page-link"
                              *ngIf="currentPage != lastPage"
                              (click)="last()"
                            >
                              {{ lastPage }}
                            </button>
                          </li>

                          <li class="page-item">
                            <button
                              class="page-link"
                              [disabled]="currentPage == lastPage"
                              (click)="next()"
                            >
                              Next
                            </button>
                          </li>
                        </ul>
                      </nav>

                      <!-- show_filter -->
                      <select
                        class="show_filter form-control form-input"
                        style="
                          cursor: pointer;
                          width: 100px;
                          height: 40px;
                          position: absolute;
                          bottom: 0px;
                          left: 30px;
                          z-index: 22;
                        "
                        (change)="onSelectChange($event)"
                      >
                        <option value="10">10</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="الكل">الكل</option>
                      </select>
                    </div>
                    <div class="table-responsive" *ngIf="!loading">
                      <table
                        id="datatable"
                        class="table table-bordered table-striped dt-responsive nowrap w-100"
                      >
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>Image</th>
                            <th>Title</th>
                            <th>Blog Category</th>
                            <th>Blog Subcategory</th>
                            <th>Schedule Date</th>

                            <th class="nosort">Actions</th>
                            <!-- <th>Delete</th> -->
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let item of DataAarry; let index = index">
                            <td style="width: 30px">{{ item.id }}</td>
                            <td style="width: 80px">
                              <img
                                src="{{ imageSrc + item?.main_img }}"
                                class="rounded-img"
                                style="width: 50px; height: 50px"
                                alt=""
                              />
                            </td>
                            <td title="{{ item.ar_title }}">
                              {{ truncateText(item.ar_title, 30) }}
                            </td>
                            <td title="{{ item.blog_category?.ar_title }}">
                              {{
                                truncateText(item.blog_category?.ar_title, 30)
                              }}
                            </td>
                            <td title="{{ item.blog_sub_category?.ar_title }}">
                              {{
                                truncateText(
                                  item.blog_sub_category?.ar_title,
                                  40
                                )
                              }}
                            </td>

                            <td>{{ item.schedule_date }}</td>

                            <td style="width: 100px">
                              <button
                                [routerLink]="['/blog-update', item.id]"
                                (click)="getShowId(item.id)"
                                (click)="showData(item.id)"
                                aria-hidden="true"
                                class="btn btn-outline-secondary btn-sm edit"
                                title="Edit"
                              >
                                <i class="fas fa-pencil-alt"></i>
                              </button>
                              <button
                                *ngIf="item.status == 1"
                                data-bs-toggle="modal"
                                data-bs-target="#delete"
                                (click)="getId(item.id)"
                                class="btn btn-outline-secondary btn-sm ms-4 edit"
                              >
                                <i class="fa fa-remove" aria-hidden="true"></i>
                              </button>
                              <button
                                *ngIf="item.status == 0"
                                data-bs-toggle="modal"
                                data-bs-target="#recovery"
                                (click)="getId(item.id)"
                                class="btn btn-outline-secondary btn-sm ms-4 edit"
                              >
                                <i class="fa-solid fa-rotate-left"></i>
                              </button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- end col -->
          </div>
          <!-- end row -->
        </div>
        <!-- container-fluid -->
      </div>
      <!-- End Page-content -->

      <!-- <button  id="FixedDash" routerLink="/Home/en"   class="btn btnbebe ">Back To Home </button> -->

      <app-footer></app-footer>
    </div>
    <!-- end main content-->
  </div>
  <!-- END layout-wrapper -->

  <!-- Add Modal -->
  <div
    class="modal align-items-center fade"
    id="add"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add New</h5>
          <button
            type="button"
            (click)="emptyForm()"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <div
            class="w-100 spinner d-flex justify-content-center align-items-center"
            *ngIf="loadingA"
          >
            <app-spinner></app-spinner>
          </div>
          <div
            *ngIf="showTryMSG"
            style="position: static !important"
            class="alert alert-danger text-center"
            role="alert"
          >
            Please try again
          </div>
          <form class="row g-3" [formGroup]="newData" *ngIf="!loadingA">
            <div class="col-md-12">
              <label for="" class="form-label">Title</label>
              <input
                type="text"
                (keydown)="handleKeydown($event)"
                class="form-control"
                [class.is-valid]="newData.controls.ar_title.status == 'VALID'"
                [class.is-invalid]="
                  newData.controls.ar_title.status == 'INVALID' &&
                  newData.controls.ar_title.touched
                "
                formControlName="ar_title"
                id=""
                value=""
                required
              />
            </div>

            <div id="" class="text-danger col-md-12 fs-6" role="alert">
              <span *ngIf="newData.controls.ar_title.errors?.['maxlength']">
                Title must contain no more than 90 characters</span
              >
            </div>

            <div class="col-md-12">
              <label for="validationServer03" class="form-label">
                Blog Introduction
              </label>
              <textarea
                type="text"
                class="form-control"
                [class.is-valid]="newData.controls.ar_intro.status == 'VALID'"
                [class.is-invalid]="
                  newData.controls.ar_intro.status == 'INVALID' &&
                  newData.controls.ar_intro.touched
                "
                formControlName="ar_intro"
                id="validationServer03"
                value=""
                required
              ></textarea>
            </div>

            <div class="col-md-12">
              <label for="validationServer03" class="form-label"
                >Blog Description</label
              >

              <ckeditor
                lang="en"
                [config]="{ contentsLangDirection: 'rtl' }"
                data=""
                class="form-control rtl-content"
                [class.is-valid]="newData.controls.ar_text.status == 'VALID'"
                [class.is-invalid]="
                  newData.controls.ar_text.status == 'INVALID' &&
                  newData.controls.ar_text.touched
                "
                formControlName="ar_text"
                id="validationServer03"
                value=""
                required
              ></ckeditor>
            </div>

            <div id="" class="text-danger col-md-12 fs-6" role="alert">
              <span *ngIf="newData.controls.ar_intro.errors?.['maxlength']">
                Title must contain no more than 320 characters</span
              >
            </div>

            <div class="col-md-12">
              <label for="validationServer03" class="form-label">
                Blog Script
              </label>
              <textarea
                type="text"
                class="form-control"
                [class.is-valid]="
                  newData.controls.blog_script.status == 'VALID'
                "
                [class.is-invalid]="
                  newData.controls.blog_script.status == 'INVALID' &&
                  newData.controls.blog_script.touched
                "
                formControlName="blog_script"
                id="validationServer03"
                value=""
                required
              ></textarea>
            </div>

            <div class="col-md-12">
              <label for="validationServer04" class="form-label"
                >Blog Category
              </label>
              <select
                class="form-control"
                [(ngModel)]="selectedCategoryIdADD"
                (ngModelChange)="onCategoryChangeADD()"
                [class.is-valid]="
                  newData.controls.blog_category_id.status == 'VALID'
                "
                [class.is-invalid]="
                  newData.controls.blog_category_id.status == 'INVALID' &&
                  newData.controls.blog_category_id.touched
                "
                formControlName="blog_category_id"
              >
                <option
                  *ngFor="let category of CategoryAarry"
                  (click)="getSubForAdd(category.ar_title)"
                  value="{{ category.id }}"
                >
                  {{ category.ar_title }}
                </option>
              </select>
            </div>

            <div class="col-md-12" *ngIf="noSubADD">
              <label for="validationServer04" class="form-label"
                >Blog Subcategory
              </label>
              <select
                class="form-control"
                [class.is-valid]="
                  newData.controls.blog_sub_category_id.status == 'VALID'
                "
                [class.is-invalid]="
                  newData.controls.blog_sub_category_id.status == 'INVALID' &&
                  newData.controls.blog_sub_category_id.touched
                "
                formControlName="blog_sub_category_id"
              >
                <option
                  *ngFor="let Subcategory of CategoryFilterBySubForADD"
                  value="{{ Subcategory.id }}"
                >
                  {{ Subcategory.ar_title }}
                </option>
              </select>
            </div>

            <div class="col-md-6">
              <label for="validationServer04" class="form-label"
                >Meta Title</label
              >
              <textarea
                type="text"
                class="form-control"
                [class.is-valid]="
                  newData.controls.ar_tag_title.status == 'VALID'
                "
                [class.is-invalid]="
                  newData.controls.ar_tag_title.status == 'INVALID' &&
                  newData.controls.ar_tag_title.touched
                "
                formControlName="ar_tag_title"
                value=""
                required
              ></textarea>
            </div>

            <div class="col-md-6">
              <label for="validationServer04" class="form-label"
                >Meta Description
              </label>
              <textarea
                type="text"
                class="form-control"
                [class.is-valid]="
                  newData.controls.ar_tag_text.status == 'VALID'
                "
                [class.is-invalid]="
                  newData.controls.ar_tag_text.status == 'INVALID' &&
                  newData.controls.ar_tag_text.touched
                "
                formControlName="ar_tag_text"
                value=""
                required
              ></textarea>
            </div>

            <div class="mb-3 col-md-6">
              <label for="formFile" class="form-label">Choose Image</label>
              <input
                class="form-control"
                type="file"
                [class.is-valid]="newData.controls.main_img.status == 'VALID'"
                [class.is-invalid]="
                  newData.controls.main_img.status == 'INVALID' &&
                  newData.controls.main_img.touched
                "
                formControlName="main_img"
                accept="image/*"
                (change)="image($event)"
                id="formFile"
              />
            </div>

            <div class="mb-3 col-md-6">
              <label for="formFile" class="form-label"
                >Choose blog images</label
              >
              <input
                class="form-control tt"
                type="file"
                formControlName="arrayOfImages"
                accept="image/*"
                (change)="imagetwo($event)"
                id="formFile"
                multiple
              />
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button type="button" (click)="addData(formData)" class="btn btnbebe">
            Add
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- update model -->
  <div
    class="modal align-items-center fade"
    id="update"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Update Data</h5>
          <button
            type="button"
            (click)="emptyForm()"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <div
            class="w-100 spinner d-flex justify-content-center align-items-center"
            *ngIf="loadingU"
          >
            <app-spinner></app-spinner>
          </div>
          <div
            *ngIf="showTryMSG"
            style="position: static !important"
            class="alert alert-danger text-center"
            role="alert"
          >
            Please try again
          </div>
          <form class="row g-3" [formGroup]="newData" *ngIf="!loadingU">
            <div
              *ngIf="wrongData"
              class="alert alert-danger text-center"
              role="alert"
            >
              Data invalid
            </div>

            <div class="col-md-12">
              <label for="" class="form-label">Title</label>
              <input
                type="text"
                (keydown)="handleKeydown($event)"
                class="form-control"
                [class.is-valid]="newData.controls.ar_title.status == 'VALID'"
                [class.is-invalid]="
                  newData.controls.ar_title.status == 'INVALID' &&
                  newData.controls.ar_title.touched
                "
                formControlName="ar_title"
                [value]="ShowAarry?.ar_title"
                id=""
                value=""
                required
              />
            </div>

            <div id="" class="text-danger col-md-12 fs-6" role="alert">
              <span *ngIf="newData.controls.ar_title.errors?.['maxlength']">
                Title must contain no more than 90 characters</span
              >
            </div>

            <div class="col-md-12">
              <label for="validationServer03" class="form-label">
                Blog Introduction
              </label>
              <textarea
                type="text"
                class="form-control"
                [class.is-valid]="newData.controls.ar_intro.status == 'VALID'"
                [class.is-invalid]="
                  newData.controls.ar_intro.status == 'INVALID' &&
                  newData.controls.ar_intro.touched
                "
                formControlName="ar_intro"
                id="validationServer03"
                value=""
                required
              ></textarea>
            </div>

            <div id="" class="text-danger col-md-12 fs-6" role="alert">
              <span *ngIf="newData.controls.ar_intro.errors?.['maxlength']">
                Title must contain no more than 320 characters</span
              >
            </div>

            <div class="col-md-12">
              <label for="validationServer03" class="form-label"
                >Blog Description</label
              >

              <ckeditor
                lang="ar"
                [config]="{ contentsLangDirection: 'rtl' }"
                data="<p>{{ ShowAarry?.ar_text }}</p>"
                class="form-control rtl-content"
                [class.is-valid]="newData.controls.ar_text.status == 'VALID'"
                [class.is-invalid]="
                  newData.controls.ar_text.status == 'INVALID' &&
                  newData.controls.ar_text.touched
                "
                formControlName="ar_text"
                id="validationServer03"
                value=""
                required
              ></ckeditor>
            </div>

            <div class="col-md-6">
              <label for="validationServer04" class="form-label"
                >Blog Category
              </label>
              <select
                class="form-control"
                [class.is-valid]="
                  newData.controls.blog_category_id.status == 'VALID'
                "
                [class.is-invalid]="
                  newData.controls.blog_category_id.status == 'INVALID' &&
                  newData.controls.blog_category_id.touched
                "
                formControlName="blog_category_id"
              >
                <option
                  *ngFor="let category of CategoryAarry"
                  value="{{ category.id }}"
                >
                  {{ category.ar_title }}
                </option>
              </select>
            </div>

            <div class="col-md-6">
              <label for="validationServer04" class="form-label"
                >Blog Subcategory
              </label>
              <select
                class="form-control"
                [class.is-valid]="
                  newData.controls.blog_category_id.status == 'VALID'
                "
                [class.is-invalid]="
                  newData.controls.blog_category_id.status == 'INVALID' &&
                  newData.controls.blog_category_id.touched
                "
                formControlName="blog_sub_category_id"
                [value]="ShowAarry?.blog_sub_category_id"
              >
                <option
                  *ngFor="let Subcategory of SubCategoriesAarry"
                  value="{{ Subcategory.id }}"
                >
                  {{ Subcategory.ar_title }}
                </option>
              </select>
            </div>

            <div class="col-md-6">
              <label for="validationServer04" class="form-label"
                >Meta Title</label
              >
              <textarea
                type="text"
                class="form-control"
                [class.is-valid]="
                  newData.controls.ar_tag_title.status == 'VALID'
                "
                [class.is-invalid]="
                  newData.controls.ar_tag_title.status == 'INVALID' &&
                  newData.controls.ar_tag_title.touched
                "
                formControlName="ar_tag_title"
                [value]="ShowAarry?.ar_tag_title"
                id="validationServer04"
                value=""
                required
              ></textarea>
            </div>

            <div class="col-md-6">
              <label for="validationServer04" class="form-label"
                >Meta Description
              </label>
              <textarea
                type="text"
                class="form-control"
                [class.is-valid]="
                  newData.controls.ar_tag_text.status == 'VALID'
                "
                [class.is-invalid]="
                  newData.controls.ar_tag_text.status == 'INVALID' &&
                  newData.controls.ar_tag_text.touched
                "
                formControlName="ar_tag_text"
                [value]="ShowAarry?.ar_tag_text"
                id="validationServer04"
                value=""
                required
              ></textarea>
            </div>

            <div class="mb-3 col-md-6">
              <label for="formFile" class="form-label">Choose Image</label>
              <input
                class="form-control"
                type="file"
                accept="image/*"
                formControlName="main_img"
                [class.is-valid]="newData.controls.main_img.status == 'VALID'"
                [class.is-invalid]="
                  newData.controls.main_img.status == 'INVALID' &&
                  newData.controls.main_img.touched
                "
                (change)="image($event)"
                [value]="ShowAarry?.main_img"
              />
            </div>

            <div class="mb-3 col-md-6">
              <img
                style="width: 50px; height: 50px; margin-top: 25px"
                class="imgshow"
                src="{{ imageSrc + ShowAarry?.main_img }}"
                alt=""
              />
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            (click)="updateData(formData, ShowAarry?.id)"
            class="btn btnbebe"
          >
            Update
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- delete Modal -->
  <div
    class="modal fade"
    id="delete"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body d-flex justify-content-center">
          <div
            class="w-100 spinner d-flex justify-content-center align-items-center"
            *ngIf="loadingD"
          >
            <app-spinner></app-spinner>
          </div>
          <h5 *ngIf="!loadingD" class="text-danger">
            Are you sure to disable this
          </h5>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            data-bs-dismiss="modal"
            (click)="disabledData(idValue)"
            class="btn btnbebe"
          >
            Disable
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- recovery Modal -->
  <div
    class="modal fade"
    id="recovery"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body d-flex justify-content-center">
          <div
            class="w-100 spinner d-flex justify-content-center align-items-center"
            *ngIf="loadingR"
          >
            <app-spinner></app-spinner>
          </div>
          <h5 *ngIf="!loadingR" class="text-danger">
            Are you sure to activate this
          </h5>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            (click)="recoveryData(idValue)"
            class="btn btnbebe"
          >
            Activate
          </button>
        </div>
      </div>
    </div>
  </div>
</body>
<div class="alert alert-danger mt-2 text-center sideRedAlert" role="alert">
  <i
    class="mt-1 ms-2 me-2 fa-solid fa-circle-exclamation animate__animated animate__pulse animate__slowe animate__infinite"
  ></i>
  Loading time longer than expected.<a
    style="
      cursor: pointer;
      border-bottom: solid red 1px;
      font-weight: 900;
      margin-left: 10px;
    "
    (click)="reloadPage()"
    >Reload</a
  >
</div>
